services:
  device:
    build:
      context: "./zmq_device"
    environment:
      - ZMQ_CLIENT_ADDRESS=tcp://*:5559
      - ZMQ_SERVER_ADDRESS=tcp://*:5560

  api:
    build:
      context: ./
      dockerfile: ./api/Dockerfile
      # MODE=[dev | prod] docker compose up -d --build 
      target: ${MODE:-dev}
    container_name: rust_api
    ports:
      - "6060:8000"
    environment:
      - ZMQ_ADDRESS=tcp://device:5559

  bot:
    build:
      context: ./
      dockerfile: ./killua/Dockerfile
      # MODE=[dev | prod] docker compose up -d --build 
      # default is dev
      target: ${MODE:-dev}
    container_name: python_bot
    environment:
      - PORT=6060
      - ZMQ_ADDRESS=tcp://device:5560